import{a as c}from"./chunk-AVA2K2V4.js";import{a as O}from"./chunk-6UCE64RY.js";import{g as f}from"./chunk-GSPRA6UI.js";import{a as R,d as pe}from"./chunk-6RKBAXAY.js";import{a as ce}from"./chunk-EUQHOON7.js";import"./chunk-23DXHAC6.js";import{B as w,Da as W,Fa as d,Ha as b,Kb as Q,M as K,O as G,R as s,Tb as ee,U as S,V as i,W as k,Za as X,a as z,db as Y,fa as q,gc as te,hc as re,ic as E,jc as A,k as J,kc as oe,lc as ie,na as u,nc as ne,oc as ae,p as y,q as D,qc as se,r as Z,za as n}from"./chunk-TN4X7B5X.js";var le=[{path:"",redirectTo:"auth",pathMatch:"full"},{path:"auth",loadChildren:()=>import("./chunk-OGTQZQH6.js")},{path:"main",loadChildren:()=>import("./chunk-XJ3IAXM6.js")}];var I=class extends Error{};I.prototype.name="InvalidTokenError";function ve(r){return decodeURIComponent(atob(r).replace(/(.)/g,(e,t)=>{let o=t.charCodeAt(0).toString(16).toUpperCase();return o.length<2&&(o="0"+o),"%"+o}))}function ge(r){let e=r.replace(/-/g,"+").replace(/_/g,"/");switch(e.length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return ve(e)}catch{return atob(e)}}function me(r,e){if(typeof r!="string")throw new I("Invalid token specified: must be a string");e||(e={});let t=e.header===!0?0:1,o=r.split(".")[t];if(typeof o!="string")throw new I(`Invalid token specified: missing part #${t+1}`);let p;try{p=ge(o)}catch(a){throw new I(`Invalid token specified: invalid base64 for part #${t+1} (${a.message})`)}try{return JSON.parse(p)}catch(a){throw new I(`Invalid token specified: invalid json for part #${t+1} (${a.message})`)}}var x=class r{constructor(e){this._http=e}get(e){throw new Error("Method not implemented.")}onGet(e,t){return this._http.get(c.API_BASE_URL+e,{params:t})}onPost(e,t,o){return this._http.post(c.API_BASE_URL+e,t,{params:o})}onPatch(e,t,o){return this._http.patch(c.API_BASE_URL+e,t,{params:o})}onDelete(e,t){return this._http.delete(c.API_BASE_URL+e,{params:t})}onPut(e,t,o){return this._http.put(c.API_BASE_URL+e,t,{params:o})}static \u0275fac=function(t){return new(t||r)(S(E))};static \u0275prov=s({token:r,factory:r.\u0275fac,providedIn:"root"})};var U=class r{_api=i(x);_user=new J(1);set user(e){this._user.next(e)}get user$(){return this._user.asObservable()}get(e){return this._api.onGet("GetUserData?userId="+e).pipe(G(t=>{}))}update(e){return this._api.onPatch("",{user:e}).pipe(Z(t=>{this._user.next(t)}))}static \u0275fac=function(t){return new(t||r)};static \u0275prov=s({token:r,factory:r.\u0275fac,providedIn:"root"})};var j=class{static isTokenExpired(e,t){if(!e||e==="")return!0;let o=this._getTokenExpirationDate(e);return t=t||0,o===null?!0:!(o.valueOf()>new Date().valueOf()+t*1e3)}static _b64decode(e){let t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",o="";if(e=String(e).replace(/=+$/,""),e.length%4===1)throw new Error("'atob' failed: The string to be decoded is not correctly encoded.");for(let p=0,a,v,T=0;v=e.charAt(T++);~v&&(a=p%4?a*64+v:v,p++%4)?o+=String.fromCharCode(255&a>>(-2*p&6)):0)v=t.indexOf(v);return o}static _b64DecodeUnicode(e){return decodeURIComponent(Array.prototype.map.call(this._b64decode(e),t=>"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2)).join(""))}static _urlBase64Decode(e){let t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:{t+="==";break}case 3:{t+="=";break}default:throw Error("Illegal base64url string!")}return this._b64DecodeUnicode(t)}static _decodeToken(e){if(!e)return null;let t=e.split(".");if(t.length!==3)throw new Error("The inspected token doesn't appear to be a JWT. Check to make sure it has three parts and see https://jwt.io for more.");let o=this._urlBase64Decode(t[1]);if(!o)throw new Error("Cannot decode the token.");return JSON.parse(o)}static _getTokenExpirationDate(e){let t=this._decodeToken(e);if(!t.hasOwnProperty("exp"))return null;let o=new Date(0);return o.setUTCSeconds(t.exp),o}};var C=class r{_authenticated=!1;_httpClient=i(E);_userService=i(U);_translateService=i(R);_toasterService=i(O);set accessToken(e){localStorage.setItem("accessToken",e)}setLocalStorageData(e){if(e?.accessToken&&e.accessTokenExpiryDate&&e.refreshToken){let t=new Date(e.accessTokenExpiryDate).getTime();localStorage.setItem("refreshToken",e.refreshToken),localStorage.setItem("accessToken",e.accessToken),localStorage.setItem("expires_at",JSON.stringify(t)),localStorage.setItem("branchId",this.getBranchId.toString())}}get accessToken(){return localStorage.getItem("accessToken")??""}get getBranchId(){let e=localStorage.getItem("accessToken"),t;return e&&(t=JSON.parse(atob(e.split(".")[1])).branchId),t}get isAuthenticated(){return this._authenticated}forgotPassword(e,t){return this._httpClient.post(c.API_BASE_URL+e,z({},t))}resetPassword(e){return this._httpClient.post(c.API_BASE_URL+"resetPassword",e)}activateUserAccount(e){return this._httpClient.post(c.API_BASE_URL+"EmailConfirmation",e)}signIn(e,t){return this._httpClient.post(c.API_BASE_URL+e,t).pipe(K(o=>(o.isValid?(this.setLocalStorageData(o.value),this._authenticated=!0,this._userService.user=me(this.accessToken)):o.errors?.length&&this._toasterService.toast(o.errors[0],"error"),y(o))),w(o=>(this._authenticated=!1,D(()=>new Error("Login failed. Please try again.")))))}signInUsingToken(){return this._httpClient.post("api/auth/sign-in-with-token",{accessToken:this.accessToken}).pipe(w(()=>y(!1)),K(e=>(e.accessToken&&(this.accessToken=e.accessToken),this._authenticated=!0,this._userService.user=e.user,y(!0))))}signOut(){return localStorage.clear(),this._authenticated=!1,this._toasterService.toast(this._translateService.translate("AUTH_LAYOUT.SESSION_EXPIRED"),"info"),location.reload(),y(!0)}signUp(e){return this._httpClient.post(c.API_BASE_URL+"SEC_RegisterNewTemp",e)}unlockSession(e){return this._httpClient.post("api/auth/unlock-session",e)}check(){if(this.accessToken)this._authenticated=!0;else return y(!1);return this._authenticated?y(!0):j.isTokenExpired(this.accessToken)?y(!1):this.signInUsingToken()}static \u0275fac=function(t){return new(t||r)};static \u0275prov=s({token:r,factory:r.\u0275fac,providedIn:"root"})};var N=class r{constructor(e){this.router=e}isSideMenuCollapsed=!1;showLoader=!1;show(){this.showLoader=!0}hide(){this.showLoader=!1}isCurrentURL(e){return this.router.url.includes(e)}static \u0275fac=function(t){return new(t||r)(S(ae))};static \u0275prov=s({token:r,factory:r.\u0275fac,providedIn:"root"})};var ue=(r,e)=>{let t=i(C),o=i(N),p=i(O),a=i(R),v=l=>{let g="Server error, please try again.",_="";return l?.error instanceof ErrorEvent?_=`Error: ${l.error.message}`:_=l?.error?.firstError?.message||l?.error?.errorsList?.[0]?.message||l?.error?.errors?.[0]||Object.values(l?.error?.errors)?.[0]?.[0]||Object.values(l?.error?.errorsList)?.[0]?.[0]||l?.error?.error||g,p.toast(_,"error"),window.scrollTo({top:0,behavior:"smooth"}),o.hide(),D(_||l||g)},T=r;return t.accessToken&&(T=r.clone({setHeaders:{Authorization:`Bearer ${t.accessToken}`,lang:a.getActiveLang()}})),(l=>l.pipe(w(g=>(g instanceof re&&(g.status===401?t.signOut():g.status===0&&(t.signOut(),console.error("Network error or server unreachable:",g))),v(g)))))(e(T))};var de=()=>[A(oe([ue])),{provide:k,useValue:()=>i(C),multi:!0}];var P=class r{constructor(){let e=i(ie),t=i(ce);t.addSvgIconSet(e.bypassSecurityTrustResourceUrl("assets/icons/material-twotone.svg")),t.addSvgIconSetInNamespace("mat_outline",e.bypassSecurityTrustResourceUrl("assets/icons/material-outline.svg")),t.addSvgIconSetInNamespace("mat_solid",e.bypassSecurityTrustResourceUrl("assets/icons/material-solid.svg")),t.addSvgIconSetInNamespace("feather",e.bypassSecurityTrustResourceUrl("assets/icons/feather.svg")),t.addSvgIconSetInNamespace("heroicons_outline",e.bypassSecurityTrustResourceUrl("assets/icons/heroicons-outline.svg")),t.addSvgIconSetInNamespace("heroicons_solid",e.bypassSecurityTrustResourceUrl("assets/icons/heroicons-solid.svg")),t.addSvgIconSetInNamespace("heroicons_mini",e.bypassSecurityTrustResourceUrl("assets/icons/heroicons-mini.svg"))}static \u0275fac=function(t){return new(t||r)};static \u0275prov=s({token:r,factory:r.\u0275fac,providedIn:"root"})};var fe=()=>[{provide:k,useValue:()=>i(P),multi:!0}];var h=class r{constructor(e,t){this.element=e;this.control=t}pattern;onChange;onTouch;onInputChange(e){let t=this.element.nativeElement.value;if(e.data){let o;e.data==="."?o=`0${e.data}0`.match(this.pattern):o=e.data.match(this.pattern),o||(t=t.replace(e.data,""))}t=t.match(this.pattern),this.element.nativeElement.value=Array.isArray(t)?t[0]:"",this.control.control&&this.control.control.setValue(this.element.nativeElement.value),t!==this.element.nativeElement.value&&e.stopPropagation()}onFocusOut(e){this.control.control&&this.control.control.setValue(this.element.nativeElement.value)}static \u0275fac=function(t){return new(t||r)(n(u),n(f))};static \u0275dir=d({type:r,selectors:[["input","keyPatternController",""],["textarea","keyPatternController",""]],hostBindings:function(t,o){t&1&&Y("input",function(a){return o.onInputChange(a)})("focusout",function(a){return o.onFocusOut(a)})},inputs:{pattern:"pattern"}})};var H=class r extends h{constructor(t,o){super(t,o);this.element=t;this.control=o}pattern=/^([a-zA-Z0-9]*)/g;static \u0275fac=function(o){return new(o||r)(n(u),n(f))};static \u0275dir=d({type:r,selectors:[["input","alphanumeric",""],["textarea","alphanumeric",""]],features:[b]})};var B=class r extends h{constructor(t,o){super(t,o);this.element=t;this.control=o}pattern=/^([A-Za-z \u0621-\u064A ]*)/g;static \u0275fac=function(o){return new(o||r)(n(u),n(f))};static \u0275dir=d({type:r,selectors:[["input","alphaOnly",""],["textarea","alphaOnly",""]],features:[b]})};var F=class r extends h{constructor(t,o){super(t,o);this.element=t;this.control=o}pattern=/^(?![.,]?$)\d*[,.]?(?![.,]?$)\d*[,.]?(?![.,]?$)\d*[,.]?(?![.,]?$)\d*[,.]?$/;static \u0275fac=function(o){return new(o||r)(n(u),n(f))};static \u0275dir=d({type:r,selectors:[["input","numbersDotOnly",""],["textarea","numbersDotOnly",""]],features:[b]})};var $=class r extends h{constructor(t,o){super(t,o);this.element=t;this.control=o}pattern=/[0-9]*/g;static \u0275fac=function(o){return new(o||r)(n(u),n(f))};static \u0275dir=d({type:r,selectors:[["input","numbersOnly",""],["textarea","numbersOnly",""]],features:[b]})};var M=class r{constructor(e){this.http=e}getTranslation(e){return fetch(`./assets/i18n/${e}.json`).then(t=>t.json())}static \u0275fac=function(t){return new(t||r)(S(E))};static \u0275prov=s({token:r,factory:r.\u0275fac,providedIn:"root"})};var he={providers:[q(),Q(),se(le),$,F,H,B,de(),fe(),A(),pe({config:{availableLangs:["en","ar"],defaultLang:be(),reRenderOnLangChange:!0,prodMode:!ee()},loader:M})]};function be(){let r=localStorage.getItem("language")||"en";return Ie(r),r}function Ie(r){let e="ltr";r==="ar"&&(e="rtl"),document.getElementsByTagName("html")[0].setAttribute("direction",e)}var V=class r{title="our-africa";static \u0275fac=function(t){return new(t||r)};static \u0275cmp=W({type:r,selectors:[["app-root"]],decls:1,vars:0,template:function(t,o){t&1&&X(0,"router-outlet")},dependencies:[ne],encapsulation:2})};te(V,he).catch(r=>console.error(r));
